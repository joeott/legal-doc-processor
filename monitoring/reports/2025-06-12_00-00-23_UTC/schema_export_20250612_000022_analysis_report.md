# Database Schema Analysis Report

Generated: 2025-06-12 00:00:54 UTC

## Executive Summary

This report provides a comprehensive analysis of the legal-doc-processor database schema, Redis cache state, and Pydantic model definitions.

### Quick Stats
- **Database Tables:** 14
- **Total Columns:** 187
- **Foreign Keys:** 17
- **Triggers:** 6
- **Functions:** 12
- **Redis Keys:** 0
- **Pydantic Models:** 0

## Database Schema Analysis

### Table Overview

#### canonical_entities
- **Columns:** 12
- **Primary Key:** 
- **Foreign Keys:** 0
- **Indexes:** 3
- **Row Count:** 66

#### canonical_entity_embeddings
- **Columns:** 7
- **Primary Key:** 
- **Foreign Keys:** 1
- **Indexes:** 1
- **Row Count:** 0
- **References:**
  - ['canonical_entity_uuid'] → canonical_entities.['canonical_entity_uuid']

#### chunk_embeddings
- **Columns:** 7
- **Primary Key:** 
- **Foreign Keys:** 1
- **Indexes:** 1
- **Row Count:** 0
- **References:**
  - ['chunk_uuid'] → document_chunks.['chunk_uuid']

#### document_chunks
- **Columns:** 21
- **Primary Key:** 
- **Foreign Keys:** 2
- **Indexes:** 4
- **Row Count:** 24
- **References:**
  - ['document_fk_id'] → source_documents.['id']
  - ['document_uuid'] → source_documents.['document_uuid']

#### document_processing_history
- **Columns:** 8
- **Primary Key:** 
- **Foreign Keys:** 1
- **Indexes:** 0
- **Row Count:** 0
- **References:**
  - ['document_uuid'] → source_documents.['document_uuid']

#### entity_mentions
- **Columns:** 16
- **Primary Key:** 
- **Foreign Keys:** 3
- **Indexes:** 5
- **Row Count:** 98
- **References:**
  - ['chunk_fk_id'] → document_chunks.['id']
  - ['chunk_uuid'] → document_chunks.['chunk_uuid']
  - ['document_uuid'] → source_documents.['document_uuid']

#### import_sessions
- **Columns:** 10
- **Primary Key:** 
- **Foreign Keys:** 1
- **Indexes:** 1
- **Row Count:** 0
- **References:**
  - ['project_uuid'] → projects.['project_id']

#### neo4j_documents
- **Columns:** 10
- **Primary Key:** 
- **Foreign Keys:** 1
- **Indexes:** 0
- **Row Count:** 0
- **References:**
  - ['document_uuid'] → source_documents.['document_uuid']

#### processing_tasks
- **Columns:** 11
- **Primary Key:** 
- **Foreign Keys:** 1
- **Indexes:** 2
- **Row Count:** 5
- **References:**
  - ['document_id'] → source_documents.['document_uuid']

#### projects
- **Columns:** 18
- **Primary Key:** 
- **Foreign Keys:** 0
- **Indexes:** 2
- **Row Count:** 16

#### relationship_staging
- **Columns:** 10
- **Primary Key:** 
- **Foreign Keys:** 3
- **Indexes:** 4
- **Row Count:** 330
- **References:**
  - ['source_chunk_uuid'] → document_chunks.['chunk_uuid']
  - ['source_entity_uuid'] → canonical_entities.['canonical_entity_uuid']
  - ['target_entity_uuid'] → canonical_entities.['canonical_entity_uuid']

#### schema_version
- **Columns:** 3
- **Primary Key:** 
- **Foreign Keys:** 0
- **Indexes:** 0
- **Row Count:** 2

#### source_documents
- **Columns:** 42
- **Primary Key:** 
- **Foreign Keys:** 2
- **Indexes:** 9
- **Row Count:** 12
- **References:**
  - ['project_fk_id'] → projects.['id']
  - ['project_uuid'] → projects.['project_id']

#### textract_jobs
- **Columns:** 12
- **Primary Key:** 
- **Foreign Keys:** 1
- **Indexes:** 3
- **Row Count:** 6
- **References:**
  - ['document_uuid'] → source_documents.['document_uuid']

### Triggers
- **update_canonical_entities_updated_at**: BEFORE UPDATE on canonical_entities
- **update_document_chunks_updated_at**: BEFORE UPDATE on document_chunks
- **update_neo4j_documents_updated_at**: BEFORE UPDATE on neo4j_documents
- **update_processing_tasks_updated_at**: BEFORE UPDATE on processing_tasks
- **update_projects_updated_at**: BEFORE UPDATE on projects
- **update_source_documents_updated_at**: BEFORE UPDATE on source_documents

### Functions
- **populate_integer_fks** (FUNCTION): PLPGSQL
- **update_updated_at_column** (FUNCTION): PLPGSQL
- **uuid_generate_v1** (FUNCTION): C
- **uuid_generate_v1mc** (FUNCTION): C
- **uuid_generate_v3** (FUNCTION): C
- **uuid_generate_v4** (FUNCTION): C
- **uuid_generate_v5** (FUNCTION): C
- **uuid_nil** (FUNCTION): C
- **uuid_ns_dns** (FUNCTION): C
- **uuid_ns_oid** (FUNCTION): C
- **uuid_ns_url** (FUNCTION): C
- **uuid_ns_x500** (FUNCTION): C

## Redis Cache Analysis
No Redis keys found or connection failed.

## Pydantic Models Analysis
No Pydantic models found or import failed.

## Schema Validation
### ℹ️ Extra Tables
- textract_jobs
- schema_version
- neo4j_documents
- document_processing_history
- processing_tasks
- projects
- import_sessions
- chunk_embeddings
- canonical_entity_embeddings

## Errors and Warnings
- Redis export error: Timeout connecting to server
- Could not import models: No module named 'scripts'

---
*Report generated by schema_inspector.py on 2025-06-12 00:00:54 UTC*
